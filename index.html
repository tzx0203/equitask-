<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" />
<title>Workload Cards</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
  :root {
    --bg-body: #f1f5f9;
    --text-main: #0f172a;
    --text-muted: #64748b;
    --border: #e2e8f0;
  }
  [data-theme="dark"] {
    --bg-body: #0f172a;
    --text-main: #f8fafc;
    --text-muted: #94a3b8;
    --border: #334155;
  }

  * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

  body {
    font-family: 'Inter', sans-serif;
    background-color: var(--bg-body);
    color: var(--text-main);
    margin: 0; padding: 16px;
    display: flex; justify-content: center;
  }

  .app-wrapper { width: 100%; max-width: 1000px; display: flex; flex-direction: column; gap: 20px; }

  /* --- HEADER & CONFIG (Same as before) --- */
  header { display: flex; justify-content: space-between; align-items: center; }
  h1 { font-size: 18px; font-weight: 700; margin: 0; }
  .theme-btn { background:none; border:none; font-size:18px; cursor:pointer; opacity:0.8; }

  .config-container {
    background: #fff; border: 1px solid var(--border); border-radius: 12px;
    padding: 12px; display: flex; flex-direction: column; gap: 12px;
    box-shadow: 0 1px 2px rgba(0,0,0,0.05);
  }
  [data-theme="dark"] .config-container { background: #1e293b; }

  .input-strip { display: flex; gap: 8px; flex-wrap: wrap; }
  .input-group { flex: 1 1 18%; display: flex; flex-direction: column; gap: 4px; min-width: 60px; }
  .input-group label { font-size: 10px; font-weight: 700; color: var(--text-muted); text-transform: uppercase; }
  .input-group input {
    width: 100%; padding: 8px; text-align: center; border-radius: 6px;
    border: 1px solid var(--border); background: var(--bg-body); color: var(--text-main);
    font-size: 15px; font-weight: 600;
  }
  .input-group input:focus { outline: none; border-color: #4f46e5; background: #fff; }
  [data-theme="dark"] .input-group input:focus { background: #1e293b; }

  .action-strip {
    display: flex; justify-content: space-between; align-items: center;
    padding-top: 10px; border-top: 1px solid var(--border); gap: 10px;
  }
  .stats-area { display: flex; gap: 8px; }
  .stat-pill {
    font-size: 12px; background: var(--bg-body); padding: 4px 8px;
    border-radius: 6px; color: var(--text-muted); border: 1px solid var(--border);
  }
  .stat-pill strong { color: var(--text-main); }
  
  .btn-area { display: flex; gap: 6px; }
  button {
    cursor: pointer; font-size: 13px; font-weight: 600; padding: 8px 14px;
    border-radius: 6px; border: none; transition: opacity 0.2s;
  }
  .btn-reset { background: transparent; color: var(--text-muted); border: 1px solid var(--border); }
  .btn-go { background: #4f46e5; color: white; }
  .btn-recalc { background: #10b981; color: white; }

  /* --- NEW CARD GRID --- */
  .results-grid {
    display: grid;
    /* Responsive Grid Logic */
    grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
    gap: 16px;
  }

  .staff-card {
    background: #fff; border-radius: 12px;
    border: 1px solid var(--border);
    box-shadow: 0 2px 4px rgba(0,0,0,0.03);
    overflow: hidden;
    display: flex; flex-direction: column;
    position: relative;
    transition: transform 0.2s;
  }
  [data-theme="dark"] .staff-card { background: #1e293b; }

  /* Top Color Bar */
  .card-border-top { height: 4px; width: 100%; }

  .card-header {
    padding: 12px 12px 0 12px;
    display: flex; justify-content: space-between; align-items: center;
  }
  .staff-name { font-size: 13px; font-weight: 600; color: var(--text-muted); text-transform: uppercase; }
  
  .lock-icon {
    font-size: 14px; cursor: pointer; color: var(--border);
    transition: color 0.2s; background: none; border: none; padding: 4px;
  }
  .lock-icon.locked { color: var(--text-main); }

  .card-hero {
    padding: 2px 12px 10px 12px;
    text-align: left;
  }
  .hero-hours {
    font-size: 28px; font-weight: 800; color: var(--text-main); letter-spacing: -1px; line-height: 1;
  }
  .hero-label { font-size: 11px; color: var(--text-muted); font-weight: 500; }

  .card-tasks {
    padding: 10px;
    background: var(--bg-body);
    flex: 1; /* Pushes content to fill height */
    display: flex; flex-direction: column; gap: 8px;
    border-top: 1px solid var(--border);
  }

  /* The compact inputs inside the card */
  .task-row {
    display: flex; align-items: center; justify-content: space-between;
    background: #fff; padding: 6px 8px; border-radius: 6px;
    border: 1px solid var(--border);
    box-shadow: 0 1px 1px rgba(0,0,0,0.02);
  }
  [data-theme="dark"] .task-row { background: #1e293b; }
  
  /* Hide rows with 0 value to keep clean? Optional. Using CSS opacity for now */
  .task-row.is-zero { display: none; } /* Uncomment to auto-hide 0 rows */
  
  .task-label { font-size: 12px; font-weight: 700; color: var(--text-muted); }
  
  .task-input {
    width: 40px; border: none; background: transparent;
    text-align: right; font-size: 14px; font-weight: 700; color: var(--text-main);
    padding: 0; outline: none;
  }

  .empty-state { text-align: center; width: 100%; color: var(--text-muted); padding: 40px; font-style: italic; grid-column: 1 / -1; }

</style>
</head>
<body>

<div class="app-wrapper">
  
  <header>
    <h1>Workload Balancer</h1>
    <button class="theme-btn" onclick="toggleTheme()" id="themeIcon">ðŸŒ™</button>
  </header>

  <div class="config-container">
    <div class="input-strip">
      <div class="input-group" style="flex: 1 1 100%; max-width: 100%;">
        <label>Team Size</label>
        <input id="totalStaff" type="number" min="1" placeholder="4" inputmode="numeric">
      </div>
      <div class="input-group"><label>90m</label><input id="tasks90" type="number" min="0" placeholder="0" inputmode="numeric" oninput="updateStats()"></div>
      <div class="input-group"><label>60m</label><input id="tasks60" type="number" min="0" placeholder="0" inputmode="numeric" oninput="updateStats()"></div>
      <div class="input-group"><label>30m</label><input id="tasks30" type="number" min="0" placeholder="0" inputmode="numeric" oninput="updateStats()"></div>
      <div class="input-group"><label>15m</label><input id="tasks15" type="number" min="0" placeholder="0" inputmode="numeric" oninput="updateStats()"></div>
    </div>
    <div class="action-strip">
      <div class="stats-area">
        <div class="stat-pill">Total: <strong id="valOrders">0</strong></div>
        <div class="stat-pill">Time: <strong id="valHours">0h</strong></div>
      </div>
      <div class="btn-area">
        <button class="btn-reset" onclick="resetAll()">Reset</button>
        <button id="calcBtn" class="btn-go" onclick="initialCalculate()">Distribute</button>
        <button id="recalcBtn" class="btn-recalc" onclick="recalculateUnlocked()" style="display:none;">Recalc</button>
      </div>
    </div>
  </div>

  <!-- THE CARD GRID -->
  <div id="resultsGrid" class="results-grid">
    <div class="empty-state">Enter team size and orders above...</div>
  </div>

</div>

<script>
/* Theme & Colors */
const staffColors = ["#3b82f6", "#10b981", "#8b5cf6", "#f59e0b", "#f43f5e", "#06b6d4"];
function toggleTheme() {
  const c = document.documentElement.getAttribute('data-theme');
  const n = c === 'dark' ? 'light' : 'dark';
  document.documentElement.setAttribute('data-theme', n);
  document.getElementById('themeIcon').innerText = n === 'dark' ? 'â˜€ï¸' : 'ðŸŒ™';
  localStorage.setItem('theme', n);
}
if(localStorage.getItem('theme') === 'dark') toggleTheme();

/* Logic */
const toInt = v => { const n = parseInt(v); return isNaN(n)?0:n; }
const inputVal = id => toInt(document.getElementById(id).value);
let currentData = null; let locked = []; let staffCount = 0;

function updateStats(){
  const t90=inputVal("tasks90"), t60=inputVal("tasks60"), t30=inputVal("tasks30"), t15=inputVal("tasks15");
  const total = t90+t60+t30+t15;
  const hrs = ((t90*90)+(t60*60)+(t30*30)+(t15*15))/60;
  document.getElementById("valOrders").innerText = total;
  document.getElementById("valHours").innerText = (Number.isInteger(hrs)?hrs:hrs.toFixed(1))+"h";
}

function distributeByTime(tasks, staffStates) {
    tasks.sort((a, b) => b - a);
    tasks.forEach(dur => {
        let min = Infinity, idx = -1;
        for (let i=0; i<staffStates.length; i++) {
            if (staffStates[i].locked) continue;
            if (staffStates[i].minutes < min) { min = staffStates[i].minutes; idx = i; }
        }
        if (idx !== -1) {
            staffStates[idx].minutes += dur;
            if(dur===90) staffStates[idx].counts.T90++;
            if(dur===60) staffStates[idx].counts.T60++;
            if(dur===30) staffStates[idx].counts.T30++;
            if(dur===15) staffStates[idx].counts.T15++;
        }
    });
}

function initialCalculate(){
  staffCount = Math.max(1, inputVal("totalStaff"));
  const t90=inputVal("tasks90"), t60=inputVal("tasks60"), t30=inputVal("tasks30"), t15=inputVal("tasks15");
  if(staffCount<=0 || (t90+t60+t30+t15)===0) { alert("Check inputs"); return; }

  let pool=[];
  for(let i=0;i<t90;i++) pool.push(90); for(let i=0;i<t60;i++) pool.push(60);
  for(let i=0;i<t30;i++) pool.push(30); for(let i=0;i<t15;i++) pool.push(15);

  let states=[];
  for(let i=0;i<staffCount;i++) states.push({id:i,locked:false,minutes:0,counts:{T90:0,T60:0,T30:0,T15:0}});
  distributeByTime(pool, states);
  
  syncData(states);
  locked = new Array(staffCount).fill(false);
  renderGrid();
  document.getElementById("recalcBtn").style.display = "none";
}

function recalculateUnlocked(){
  if (!currentData) return;
  const ins = { T90:inputVal("tasks90"), T60:inputVal("tasks60"), T30:inputVal("tasks30"), T15:inputVal("tasks15") };
  let held = { T90:0, T60:0, T30:0, T15:0 };
  let states = [];

  for (let s=0; s<staffCount; s++){
    const l = locked[s];
    const d90=currentData.T90[s], d60=currentData.T60[s], d30=currentData.T30[s], d15=currentData.T15[s];
    if(l) { held.T90+=d90; held.T60+=d60; held.T30+=d30; held.T15+=d15; }
    const m = (d90*90)+(d60*60)+(d30*30)+(d15*15);
    states.push({ id:s, locked:l, minutes:l?m:0, counts:{ T90:l?d90:0, T60:l?d60:0, T30:l?d30:0, T15:l?d15:0 } });
  }

  for(let k in held) if(held[k] > ins[k]) { alert("Locked values exceed inputs"); return; }
  
  let pool = [];
  const addP = (k, dur) => { for(let i=0; i<(ins[k]-held[k]); i++) pool.push(dur); }
  addP('T90',90); addP('T60',60); addP('T30',30); addP('T15',15);
  
  if(pool.length) distributeByTime(pool, states);
  
  syncData(states);
  // We need to update DOM inputs based on new data
  renderGrid();
}

function syncData(states) {
  currentData = { T90:[], T60:[], T30:[], T15:[] };
  states.forEach(s => {
      currentData.T90.push(s.counts.T90); currentData.T60.push(s.counts.T60);
      currentData.T30.push(s.counts.T30); currentData.T15.push(s.counts.T15);
  });
}

function renderGrid(){
  const grid = document.getElementById("resultsGrid");
  grid.innerHTML = "";

  for(let i=0; i<staffCount; i++){
    const c = staffColors[i % staffColors.length];
    const d90=currentData.T90[i], d60=currentData.T60[i], d30=currentData.T30[i], d15=currentData.T15[i];
    const totalMins = (d90*90)+(d60*60)+(d30*30)+(d15*15);
    const hrs = totalMins/60;
    const hrsTxt = Number.isInteger(hrs) ? hrs : hrs.toFixed(1);
    const isLocked = locked[i];
    const lockIcon = isLocked ? "ðŸ”’" : "ðŸ”“";
    const lockClass = isLocked ? "locked" : "";
    
    // Auto-hide rows that are 0 for cleaner look?
    const s90 = d90>0?"":"is-zero"; 
    const s60 = d60>0?"":"is-zero";
    const s30 = d30>0?"":"is-zero";
    const s15 = d15>0?"":"is-zero";

    const cardHTML = `
      <div class="staff-card">
        <div class="card-border-top" style="background:${c}"></div>
        <div class="card-header">
          <div class="staff-name" style="color:${c}">Staff ${i+1}</div>
          <button class="lock-icon ${lockClass}" onclick="toggleLock(${i})">${lockIcon}</button>
        </div>
        <div class="card-hero">
          <div class="hero-hours">${hrsTxt}<span style="font-size:16px; font-weight:600">h</span></div>
          <div class="hero-label">Workload</div>
        </div>
        <div class="card-tasks">
          <div class="task-row ${s90}">
            <span class="task-label">90m</span>
            <input class="task-input" type="number" data-staff="${i}" data-type="T90" value="${d90}" oninput="manualEdit(this)">
          </div>
          <div class="task-row ${s60}">
            <span class="task-label">60m</span>
            <input class="task-input" type="number" data-staff="${i}" data-type="T60" value="${d60}" oninput="manualEdit(this)">
          </div>
          <div class="task-row ${s30}">
            <span class="task-label">30m</span>
            <input class="task-input" type="number" data-staff="${i}" data-type="T30" value="${d30}" oninput="manualEdit(this)">
          </div>
          <div class="task-row ${s15}">
            <span class="task-label">15m</span>
            <input class="task-input" type="number" data-staff="${i}" data-type="T15" value="${d15}" oninput="manualEdit(this)">
          </div>
        </div>
      </div>
    `;
    grid.innerHTML += cardHTML;
  }
}

function manualEdit(el){
  const staff = el.getAttribute('data-staff');
  const type = el.getAttribute('data-type');
  let val = parseInt(el.value);
  if(isNaN(val)) val = 0;
  
  // Update Data
  currentData[type][staff] = val;
  
  // Re-calculate Hours for this card immediately
  // Find the card element to update just the text
  const d90=currentData.T90[staff], d60=currentData.T60[staff], d30=currentData.T30[staff], d15=currentData.T15[staff];
  const totalMins = (d90*90)+(d60*60)+(d30*30)+(d15*15);
  const hrs = totalMins/60;
  const hrsTxt = Number.isInteger(hrs) ? hrs : hrs.toFixed(1);
  
  // Update Hours Text DOM
  const card = el.closest('.staff-card');
  card.querySelector('.hero-hours').innerHTML = `${hrsTxt}<span style="font-size:16px; font-weight:600">h</span>`;
  
  // Optional: Unhide row if user types > 0
  if(val > 0) el.parentElement.classList.remove('is-zero');
}

function toggleLock(i){
  locked[i] = !locked[i];
  document.getElementById("recalcBtn").style.display = locked.some(x=>x) ? "inline-block" : "none";
  renderGrid();
}

function resetAll(){
  document.getElementById("totalStaff").value = "";
  ["tasks90","tasks60","tasks30","tasks15"].forEach(id=>document.getElementById(id).value="");
  updateStats();
  document.getElementById("resultsGrid").innerHTML = `<div class="empty-state">Enter team size and orders above...</div>`;
  currentData = null; locked=[]; staffCount=0;
  document.getElementById("recalcBtn").style.display = "none";
}
</script>
</body>
</html>
